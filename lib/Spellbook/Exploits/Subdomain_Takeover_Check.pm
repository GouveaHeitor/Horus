package Spellbook::Exploits::Subdomain_Takeover_Check {
    use strict;
    use warnings;
    use LWP::UserAgent;
    use Digest::MD5 qw(md5_hex);

    sub new {
        my ($self, $hostname) = @_;
        my @results = ();

        if ($hostname) {
            my $ua = LWP::UserAgent -> new(
                ssl_opts => { verify_hostname => 0 }
            );

            my $request = $ua -> get($hostname);

            if (($request -> code() == 200) || $request -> code() == 404) {
                my %hashes = (
                    github => "1eb970ce5a18bec7165f016df8238566",
                    heroku => "387caa8a924c5f92496824494b929207"
                );

                for (keys %hashes) {
                    if (md5_hex($request -> content()) eq $hashes{$_}) {
                        push @results, $hostname, "\n"; 
                    }
                }
            }
        }

        return @results;
    }
}

1;